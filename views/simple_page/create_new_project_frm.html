<!doctype html>
<html>
<head>
    <meta charset="utf-8">
    <meta name="viewport"
          content="maximum-scale=1.0,minimum-scale=1.0,user-scalable=0,initial-scale=1.0,width=device-width"/>
    <meta name="format-detection" content="telephone=no,email=no,date=no,address=no">
    <title>Add new project</title>
    <link rel="stylesheet" type="text/css" href="../../css/api.css"/>
    <link rel="stylesheet" href="../../css/common.css">
    <link rel="stylesheet" href="../../css/fonts_awesome/font-awesome.min.css">
    <style type="text/css">
        body {
            height: 100%;
            overflow: hidden;
        }

        body.fixed {
            height: 100%;
        }

        .border-1px-bottom:after {
            color: #B3B7BA;
        }

        #nav_group {
            background-color: #FFFFFF;
            height: 5rem;
        }
        .nav-group-shadow{
            height: 5rem;
        }

        #content_group{ overflow: auto; }

        #nav_group .nav_btn {
            float: left;
            background-position: 0.6rem 50%;
            background-repeat: no-repeat;
            background-size: 2.3rem 2.3rem;
            height: 5rem;
            font-size: 1.3rem;
            line-height: 5rem;
            color: #666666;
            text-indent: 3.5rem;
            /*margin-right: 1rem;*/
            width : 33%;
        }

        #nav_group .nav_btn.step-1 {
            background-image: url(../../image/project/new_1.png);
        }

        #nav_group .nav_btn.step-2 {
            background-image: url(../../image/project/new_2.png);
        }

        #nav_group .nav_btn.step-3 {
            background-image: url(../../image/project/new_3.png);
        }

        #nav_group .nav_btn.active {
            color: #00AEEF;
        }

        #nav_group .nav_btn.step-1.active {
            background-image: url(../../image/project/new_1_highlight.png);
        }

        #nav_group .nav_btn.step-2.active {
            background-image: url(../../image/project/new_2_highlight.png);
        }

        #nav_group .nav_btn.step-3.active {
            background-image: url(../../image/project/new_3_highlight.png);
        }

        /*表单*/
        #content_group {
            position: relative;
        }

        #content_group label {
            line-height: 1.7rem;
        }

        #content_group input {
            line-height: normal;
        }

        #content_group .content-box.active {
            display: block;
        }

        #content_group .form1 {
            padding-left: 2rem;
            background-color: #FFFFFF;
            margin-top: 3rem;
        }

        #content_group .form1 .form-row {
            height: 5.5rem;
            font-size: 1.5rem;
            line-height: normal;
            -webkit-box-sizing: border-box;
            box-sizing: border-box;
            padding-top: 1.8rem;
        }

        /*#content_group .form1 .project-name {
            font-size: 1.5rem;
            line-height: normal;
        }*/

        #content_group .form1 label {
            /*width: 11rem;*/
            text-align: right;
            color: #333333;
        }

        #content_group .form2 {
            color: #555555;
            padding-left: 2rem;
            background-color: #FFFFFF;
            margin-bottom: 1.5rem;
        }

        #content_group .content-des {
            height: 3.4rem;
            line-height: 3.4rem;
            padding-left: 1.8rem;
            font-size: 1.4rem;
            color: #333333;
            padding-top: 2rem;
            font-weight: bold;
        }

        #content_group .form2 .form-row {
            height: 5.5rem;
            font-size: 1.5rem;
            line-height: normal;
            -webkit-box-sizing: border-box;
            box-sizing: border-box;
            padding-top: 1.8rem;
        }

        #content_group .form2 label {
            text-align: right;
            color: #333333;
        }

        #content_group .form4 {
            color: #555555;
            padding-left: 2rem;
            background-color: #FFFFFF;
            margin-top: 1.5rem;
        }

        #content_group .form4 .form-row {
            height: 5.5rem;
            font-size: 1.5rem;
            line-height: normal;
            -webkit-box-sizing: border-box;
            box-sizing: border-box;
            padding-top: 1.8rem;
        }

        #content_group .form4 label {
            text-align: right;
            color: #333333;
        }

        #content_group .form3 {
            color: #555555;
            padding-left: 2rem;
            background-color: #FFFFFF;
            margin-top: 3rem;
        }

        #content_group .form3 .form-row {
            height: 5.5rem;
            font-size: 1.5rem;
            line-height: normal;
            -webkit-box-sizing: border-box;
            box-sizing: border-box;
            padding-top: 1.8rem;
        }

        #content_group .form3 label {
            /*width: 12rem;*/
            text-align: right;
            color: #333333;
        }

        #content_group .form3 .form-row.form-row-lg {
            height: 10rem;
            padding-top: 2rem;
            padding-bottom: 2rem;
        }

        #content_group .form3 .product-description {
            width: 24rem;
            height: 6rem;
            border: 1px solid #CCCCCC;
            resize: none;
        }

        #content_group .form3 .form-row .form-row-left {
            float: left;
            /*width: 12rem;*/
        }

        #content_group .form3 .form-row .form-row-right {
            display: inline-block;
            width: 15rem;
            height: 100%;
            font-size: 0.9rem;
            color: #8E8E90;
            padding-top: 2rem;
        }

        #content_group .form3 .form-row .form-row-right span {
            display: block;
            line-height: 1rem;
        }

        #content_group .form3 .form-row .form-row-right .pic-name {
            font-size: 1rem;
            line-height: 1.2rem;
            margin-bottom: 1rem;
        }

        #content_group .form3 .form-row.form-row-lg label {

        }

        #content_group .form3 .form-row .product-picture {
            height: 7.5rem;
            width: 7.5rem;
            margin-right: 0.5rem;
            vertical-align: top;
        }

        .btn-submit, .btn-next {
            width: 31.9rem;
            height: 4rem;
            background-color: #00AEEF;
            border-radius: 0.2rem;
            line-height: 4rem;
            text-align: center;
            margin: 4rem auto;
            color: #FFFFFF;
            font-size: 1.4rem;
        }

        .btn-next {
            width: 14.5rem;
        }

        .btn-more {
            width: 14.3rem;
            height: 3.8rem;
            border-radius: 0.2rem;
            border: 0.1rem solid #00AEEF;
            background-color: transparent;
            text-align: center;
            margin: 4rem auto;
            color: #00AEEF;
            font-size: 1.4rem;
        }

        .btn-more span {
            line-height: 3.8rem;
            vertical-align: middle;
        }

        .btn-more .add {
            font-size: 2.8rem;
            line-height: 3.8rem;
        }

        .cover {
            position: fixed;
            left: 0;
            top: 0;
            width: 100%;
            height: 100%;
            background-color: #f5f4f9;
            background: rgba(50, 51, 49, 0.6);
            display: -webkit-box;
            z-index: 2;
        }

        .select {
            width: 100%;
            height: 30rem;
            background-color: #f5f4f9;
            position: absolute;
            bottom: 0;
            left: 0;
        }

        .select-control {
            height: 3.5rem;
            line-height: 3.5rem;
            display: -webkit-box;
        }

        .select-control-placeHolder {
            -webkit-box-flex: 1;
        }

        .select-control-cancel, .select-control-ok {
            width: 3.5rem;
            font-size: 1.5rem;
            color: #00437F;
            padding: 0 10px;
        }

        .select-content {
            height: 26.5rem;
        }

        .color-select {
            color: #00AEEF;
        }

        .text-tip {
            font-style: normal;
            font-size: 1.3rem;
            color: #C8C8C8;
            margin-right: 2rem;
            float: right;
        }

        .for-maker {
            display: none;
        }

        .for-si {
            display: block;
        }

        .maker .for-si {
            display: none;
        }

        .maker .for-maker {
            display: block;
        }
    #IntelProductNum1{
        width:4rem;
    }
    </style>
</head>

<body class="flex-wrap flex-vertical">
<!-- <div id="nav_group" class="border-1px-bottom">
    <div class="nav_btn step-1">做什么</div>
    <div class="nav_btn step-2">怎么做</div>
    <div class="nav_btn step-3">什么时候做</div>
</div>
<div id="content_group" class="flex-con"> -->
    <!-- 第一部分 -->
 <!-- <div class="content-box">
        <ul class="form1">
            <li class="form-row border-1px-top clearfix">
                <label>项目名称：</label>
                <input type="text" id="projectName" class="project-name input" placeholder="项目名称">
            </li>
            <li class="form-row border-1px-top clearfix">
                <label>市场应用：</label>
                <span class="project-apply color-select" id="projectApp"  tapmode onclick="setMarketApplicationList(this)" >---请选择---</span>
            </li>
            <li class="form-row border-1px-top clearfix projectEstimated hidden">
                <label>预计年销量：</label>
                <i class="text-tip">（台）</i>
                <input type="tel" id="projectEstimated" class="project-estimated input" placeholder="年销量"
                       style="width: 8rem;">
            </li>
            <li class="form-row border-1px-top clearfix" >
                <label>目前项目状态：</label>
                <span class="project-state color-select" id="projectStatus" tapmode onclick="AppGetProjectStatus( this )" >---请选择---</span>
            </li>
        </ul>
        <div class="btn-next" tapmode="highlight" onclick="toNext()">下一步</div>
        <div style="height:1px"></div>
    </div>
     <!-- 第二部分 -->
  <!-- <div class="content-box">
        <ul class="form4 form for-maker">
            <li class="form-row clearfix">
                <label>主板类型：</label>
                <span id="projectBoardtype" class="input color-select" tapmode
                      onclick="setBoardType(this)">---请选择---</span>
            </li>
            <li class="form-row clearfix border-1px-top" style="display: none">
                <label>主板厂商：</label>
                <input id="projectMotherboard" type="text" class="input" placeholder="">
            </li>
        </ul>
        <p class="content-des">
            项目中使用英特尔产品情况：
        </p>
        <ul class="form2">
            <li class="form-row border-1px-top clearfix" tapmode onclick="setIntelProductList1(this)">
                <label>英特尔产品类型：</label>
                <span class="product-type color-select" id="IntelProductType1">---请选择---</span>
            </li>
            <li class="form-row border-1px-top clearfix">
                <label>英特尔产品型号：</label>
                <input type="text" class="product-model input" placeholder="Intel product model" id="IntelProductNum1">
            </li>
            <li class="form-row border-1px-top clearfix" tapmode onclick="getIntelProductQty1(this)">
                <label>单套设备中使用数量：</label>
                <span class="product-count color-select" id="IntelProductQty1">---请选择---</span>
            </li>
        </ul>
        <div class="btn-more for-maker" tapmode="highlight" onclick="showOther(this)">
            <span class="add">+</span>
            <span>更多产品类型</span>
        </div>
        <div class="btn-next" tapmode="highlight" onclick="toNext()">下一步</div>
        <div style="height:1px"></div>
    </div> --> 
    <!-- 第三部分 -->
    <!-- <div class="content-box">
        <ul class="form3">
            <li class="form-row border-1px-top clearfix" tapmode onclick="setStartDate(this)">
                <label>项目起始时间：</label>
                <span class="product-start-date color-select" id="StartDate">---请选择---</span>
            </li>
            <li class="form-row for-si border-1px-top clearfix" tapmode onclick="setPurchaseDate(this)">
                <label>预计量产时间：</label>
                <span class="product-produce-date color-select" id="PurchaseDate">---请选择---</span>
            </li>
            <li class="for-maker form-row border-1px-top clearfix" tapmode onclick="setPurchaseDate2(this)">
                <label>小批量采购时间：</label>
                <span class="product-produce-date color-select" id="PurchaseDate2">---请选择---</span>
            </li>
            <li class="for-maker form-row border-1px-top clearfix">
                <label>预计小批量采购量：</label>
                <i class="text-tip">（台）</i>
                <input type="tel" id="projectEstimated2" class="project-estimated input" placeholder=""
                       style="width: 12rem;">
            </li>
            <li class="form-row for-maker border-1px-top clearfix">
                <label>预计采购渠道：</label>
                <span id="PurchaseChannel" class="product-buy-channel color-select" tapmode
                      onclick="setPurchaseChannel(this)">---请选择---</span>
            </li>
            <li class="form-other-channel form-row border-1px-top clearfix" style="display: none">
                <label>其他采购渠道：</label>
                <input id="PurchaseChannelOther" class="project-otherchannel input" type="text">
            </li>
            <li class="form-row for-si form-row-lg border-1px-top clearfix">
                <div class="form-row-left">
                    <label>项目描述：</label>
                </div>
                <textarea class="product-description input" id="ProjectDepict" name="product-description"></textarea>
            </li>
            <li class="form-row form-row-lg border-1px-top clearfix" style="height: auto;">
                <div class="form-row-left">
                    <label>图片：</label>
                </div>
                <img id="upload_img" class="product-picture" src="../../image/project/add_pic.png" alt="" tapmode
                     onclick="chooseGetType()">

                <p class="form-row-right">
                    <span class="pic-name">未选择图片</span>
                    <span>ODM请上传主板图片，</span>
                    <span>OEM请上传主机图片；</span>
                    <span>文件最大为10M。</span>
                </p>
            </li>
        </ul>
        <div class="btn-submit btn" tapmode onclick="toNext()">提交</div>
        <div style="height:1px"></div>
    </div> -->
<!-- </div> -->


<!-- <div id="modal_selector" tapmode="" onclick="selectCancel()">
    <div class="select">
        <div class="select-control">
            <div class="select-control-cancel" tapmode="" onclick="selectCancel()">取消</div>
            <div class="select-control-placeHolder"></div>
            <div class="select-control-ok" tapmode="" onclick="selectCancel()">完成</div>
        </div>
        <div class="select-content">

        </div>
    </div>
</div> -->
</body>
<script type="text/javascript" src="../../script/api.js"></script>
<script type="text/javascript" src="../../script/ajaxRequest.js"></script>
<script type="text/javascript" src="../../script/languge.js"></script>
<script type="text/javascript" src="../../script/translation.js"></script>
<script type="text/javascript">
    var index = 1;
    var loginInfo = $api.getStorage('loginInfo');
    if (loginInfo.usertype == 1 || loginInfo.usertype == 5) {

    } else {
        $api.addCls($api.dom('body'), 'maker');
    }
    var projectName = '';
    var projectApp = '';
    var projectEstimated = '';
    var projectStatus = '';
    var ProjectType = '';
    var MotherBoard = '';
    var IntelProductType1 = '';
    var IntelProductNum1 = '';
    var IntelProductQty1 = '';
    var IntelProductType2 = '';
    var IntelProductNum2 = '';
    var IntelProductQty2 = '';
    var IntelProductType3 = '';
    var IntelProductNum3 = '';
    var IntelProductQty3 = '';
    var IntelProductType4 = '';
    var IntelProductNum4 = '';
    var IntelProductQty4 = '';
    var IntelProductType5 = '';
    var IntelProductNum5 = '';
    var IntelProductQty5 = '';
    var StartDate = '';
    var PurchaseDate = '';
    var PurchaseDate2 = '';
    var projectEstimated2 = '';
    var purchaseChannel = '';
    var purchaseChannelOther = '';
    var ProjectDepict = '';
    var Photo = '';
    var UICustomPicker;
    var zhuge;
    var vGlobalUlHTML = '';
    apiready = function () {

          zhuge = api.require('zhuge');
        if (zhuge) {
            zhuge.initZhuge();
        }
        UICustomPicker = api.require('UICustomPicker');
        var _html = '';
        // USER.roleId = 9; 

        // 如果当前项目是转型前的项目，则使用前用户进行更新
        if( api.pageParam.data ){
            if( USER.roleId === CONST_MAKER_ENTERPRISE && api.pageParam.data.typesOfProjects === CREATE_USER_PARTNER ){
                USER.roleId = CONST_MAKER_PARTNER;
            }
        }
        

        switch( api.pageParam.index ){
            case 0:
                if( api.pageParam.data ){
                    var projectName = api.pageParam.data.projectName,
                        projectStatus = api.pageParam.data.projectStatus,
                        planQty = api.pageParam.data.planQty,
                        projectAppId = api.pageParam.data.projectAppId;
                }

                _html +=
                '<div class="content-box">'+
                '    <ul class="form1">'+
                '        <li class="form-row border-1px-top clearfix">'+
                '            <label>'+fnLanguageSwitch( '项目名称' )+'：</label>'+
                '            <input type="text" id="projectName" value="'+( typeof projectName !== 'undefined' ? projectName : '' )+'" class="project-name input" placeholder="'+fnLanguageSwitch( '项目名称' )+'">'+
                '        </li>'+
                '        <li class="form-row border-1px-top clearfix">'+
                '            <label>'+fnLanguageSwitch( '市场应用' )+'：</label>'+
                '            <span class="project-apply color-select" id="projectApp"  tapmode onclick="setMarketApplicationList(this)" '+( fnIsEmp( projectAppId ) ? 'data-selectorid="'+projectAppId+'"' : '')+' >'+( fnIsEmp( projectAppId ) ? fnApplicationMarketJson()[ projectAppId ] : '---'+fnLanguageSwitch( '请选择' )+'---') +'</span>'+
                '        </li>'+( USER.roleId === CONST_MAKER_ENTERPRISE ? 
                '        <li class="form-row border-1px-top clearfix">'+
                '            <label>'+fnLanguageSwitch( '预计年销量' )+'：</label>'+
                '            <i class="text-tip">（'+fnLanguageSwitch( '台' )+'）</i>'+
                '            <input type="tel" id="projectEstimated" value="'+( typeof planQty !== 'undefined' ? planQty : '')+'" class="project-estimated input" placeholder="'+fnLanguageSwitch( '年销量' )+'"'+
                '                   style="width: 10rem;">'+
                '        </li>' : '' )+
                '        <li class="form-row border-1px-top clearfix" >'+
                '            <label>'+fnLanguageSwitch( '目前项目状态' )+'：</label>'+
                '            <span class="project-state color-select" '+( fnIsEmp( projectStatus ) ? 'data-selectorid="'+ ( projectStatus )+'"' : '')+'  id="projectStatus" tapmode onclick="AppGetProjectStatus( this )" >'+( typeof projectStatus !== 'undefined' ? fnProjectApprovalStatusJson()[ projectStatus.toString() ] : '---'+fnLanguageSwitch( '请选择' )+'---' ) +'</span>'+
                '        </li>'+
                '    </ul>';
            break;
            case 1:
                if( api.pageParam.data ){
                    var projectType = api.pageParam.data.projectType,
                        motherBoard = api.pageParam.data.motherBoard,
                        intelProducts = api.pageParam.data.intelProducts && typeof api.pageParam.data.intelProducts === 'string' ? JSON.parse( api.pageParam.data.intelProducts ) :api.pageParam.data.intelProducts ;
                }
                _html +=
                '<div class="content-box">'+( USER.roleId === CONST_MAKER_ENTERPRISE ?
                '    <ul class="form4 form">'+
                '        <li class="form-row clearfix">'+
                '            <label>'+fnLanguageSwitch( '主板类型' )+'：</label>'+
                '            <span id="projectBoardtype" '+( fnIsEmp( projectType ) ? 'data-selectorid="'+ projectType +'"' : '' )+'  class="input color-select" tapmode onclick="setBoardType(this)">'+( typeof projectType !== 'undefined' ? fnMainBoardTypeJson()[ projectType ] : '---'+fnLanguageSwitch( '请选择' )+'---' ) +'</span>'+
                '        </li>'+
                '        <li class="form-row clearfix border-1px-top '+( motherBoard ? '' : 'hidden' )+'">'+
                '            <label>'+fnLanguageSwitch( '主板厂商' )+'：</label>'+
                '            <input id="projectMotherboard" style="width: 10rem;" type="text" value="'+( fnIsEmp( motherBoard ) ? motherBoard : '' )+'" class="input" 8i bh0>'+
                '        </li>'+
                '    </ul>'
                : '' )+
                '    <p class="content-des">'+
                '        '+fnLanguageSwitch( '项目中使用英特尔产品情况' )+'：'+
                '    </p>';

                vGlobalUlHTML =
                '    <ul class="form2">'+
                '        <li class="form-row border-1px-top clearfix" >'+
                '            <label>'+fnLanguageSwitch( '英特尔产品类型' )+'：</label>'+
                '            <span class="product-type color-select" tapmode onclick="setIntelProductList(this)" >---'+fnLanguageSwitch( '请选择' )+'---</span>'+
                '        </li>'+
                '        <li class="form-row border-1px-top clearfix">'+
                '            <label>'+fnLanguageSwitch( '英特尔产品型号' )+'：</label>'+
                '            <input type="text" style="width: 10rem;" class="product-model input" placeholder="'+fnLanguageSwitch( '产品型号' )+'" >'+
                '        </li>'+
                '        <li class="form-row border-1px-top clearfix" >'+
                '            <label>'+fnLanguageSwitch( '单套设备中使用数量' )+'：</label>'+
                '            <span class="product-count color-select" tapmode onclick="getIntelProductQty(this)" >---'+fnLanguageSwitch( '请选择' )+'---</span>'+
                '        </li>'+
                '    </ul>';


                if( intelProducts ){
                    for( var x in intelProducts ){
                        _html +=
                        '    <ul class="form2">'+
                        '        <li class="form-row border-1px-top clearfix" >'+
                        '            <label>'+fnLanguageSwitch( '英特尔产品类型' )+'：</label>'+
                        '            <span class="product-type color-select" tapmode onclick="setIntelProductList(this)" '+( fnIsEmp( intelProducts[x].type ) ? 'data-selectorid="'+intelProducts[x].type+'"' : '' )+'>'+( fnIsEmp( intelProducts[x].type ) ? fnProductTypeJson()[ intelProducts[x].type ] : '---'+fnLanguageSwitch( '请选择' )+'---' )+'</span>'+
                        '        </li>'+
                        '        <li class="form-row border-1px-top clearfix">'+
                        '            <label>'+fnLanguageSwitch( '英特尔产品型号' )+'：</label>'+
                        '            <input type="text" class="product-model input" value="'+( fnIsEmp( intelProducts[x].num ) ? intelProducts[x].num : '' )+'" placeholder="'+fnLanguageSwitch( '英特尔产品型号' )+'" >'+
                        '        </li>'+
                        '        <li class="form-row border-1px-top clearfix" >'+
                        '            <label>'+fnLanguageSwitch( '单套设备中使用数量' )+'：</label>'+
                        '            <span class="product-count color-select" tapmode onclick="getIntelProductQty(this)" '+( fnIsEmp( intelProducts[x].qty ) ? 'data-selectorid="'+intelProducts[x].qty+'"' : '' )+' >'+( fnIsEmp( intelProducts[x].qty ) ? intelProducts[x].qty : '---'+fnLanguageSwitch( '请选择' )+'---' )+'</span>'+
                        '        </li>'+
                        '    </ul>';
                    }
                }else{
                    _html += vGlobalUlHTML;
                }


                _html += ( USER.roleId === CONST_MAKER_ENTERPRISE && _html.match( /class="form2"/igm ) && _html.match( /class="form2"/igm ).length !== 5 ? 
                '    <div class="btn-more" id="intelAdd" tapmode="highlight" onclick="showOther(this)">'+
                '        <span class="add">+</span>'+
                '        <span>'+fnLanguageSwitch( '添加更多产品类型' )+'</span>'+
                '    </div>' : '');
                break;
                case 2:
                if( api.pageParam.data ){
                    var startDate = api.pageParam.data.startDate,
                        planDate = api.pageParam.data.planDate,
                        purchaseDate = api.pageParam.data.purchaseDate,
                        purchaseQty = api.pageParam.data.purchaseQty,
                        photo = api.pageParam.data.photo,
                        productDescription = api.pageParam.data.productDescription,
                        expectedPurChan = api.pageParam.data.expectedPurChan,
                        purchaseChannel = api.pageParam.data.purchaseChannel;
                }
                _html +=
                '<div class="content-box">'+
                '    <ul class="form3">'+
                '        <li class="form-row border-1px-top clearfix" >'+
                '            <label>'+fnLanguageSwitch( '项目起始时间' )+'：</label>'+
                '            <span class="product-start-date color-select" id="StartDate" '+( fnIsEmp( startDate ) ? 'data-selectorid="'+startDate+'"' : '')+' tapmode onclick="setStartDate(this, 0, \''+fnLanguageSwitch( '项目起始时间' )+'\')">'+( typeof startDate !== 'undefined' ? startDate : '---'+fnLanguageSwitch( '请选择' )+'---' )+'</span>'+
                '        </li>'+( USER.roleId === CONST_MAKER_PARTNER ?
                '        <li class="form-row bord`r-1px-top clearfix" >'+
                '            <label>'+fnLanguageSwitch( '预计量产时间' )+'：</label>'+
                '            <span class="product-produce-date color-select" id="PurchaseDate"  '+( fnIsEmp( planDate ) ? 'data-selectorid="'+planDate+'"' : '' )+' tapmode onclick="setStartDate(this, 1, \''+fnLanguageSwitch( '预计量产时间应该大于或等于项目起始时间' )+'\')">'+( typeof planDate !== 'undefined' ? planDate : '---'+fnLanguageSwitch( '请选择' )+'---' )+'</span>'+
                '        </li>' : '' )+( USER.roleId === CONST_MAKER_ENTERPRISE ? 
                '        <li class="form-row border-1px-top clearfix" >'+
                '            <label>'+fnLanguageSwitch( '小批量采购时间' )+'：</label>'+
                '            <span class="product-produce-date color-select" id="PurchaseDate2" '+( fnIsEmp( purchaseDate ) ? 'data-selectorid="'+purchaseDate+'"' : '' )+' tapmode onclick="setStartDate(this, 2, \''+fnLanguageSwitch( '小批量采购时间应该大于或等于项目起始时间' )+'\')" >'+( fnIsEmp( purchaseDate ) ? purchaseDate : '---'+fnLanguageSwitch( '请选择' )+'---' )+'</span>'+
                '        </li>'+
                '        <li class="for-maker form-row border-1px-top clearfix">'+
                '            <label>'+fnLanguageSwitch( '预计小批量采购量' )+'：</label>'+
                '            <i class="text-tip">（'+fnLanguageSwitch( '台' )+'）</i>'+
                '            <input type="tel" id="projectEstimated2" value="'+( fnIsEmp( purchaseQty ) ? purchaseQty : '' )+'" class="project-estimated input" style="width: 10rem;">'+
                '        </li>'+
                '        <li class="form-row for-maker border-1px-top clearfix">'+
                '            <label>'+fnLanguageSwitch( '预计采购渠道' )+'：</label>'+
                '            <span id="PurchaseChannel" class="product-buy-channel color-select" '+( fnIsEmp( expectedPurChan ) ? 'data-selectorid="'+expectedPurChan+'"' : '')+'" tapmode onclick="setPurchaseChannel(this)" >'+( fnIsEmp( expectedPurChan ) ? $api.getStorage('getPurchaseChannel')[expectedPurChan] : '---'+fnLanguageSwitch( '请选择' )+'---' )+'</span>'+
                '        </li>'

                // +
                // '        <li class="form-other-channel form-row border-1px-top clearfix">'+
                // '            <label>'+fnLanguageSwitch( '其它采购渠道' )+'：</label>'+
                // '            <input id="PurchaseChannelOther" class="project-otherchannel input" value="'+( fnIsEmp( purchaseChannel ) ? purchaseChannel : '' )+'" type="text" style="width: 6rem;">'+
                // '        </li>' 

                : '' )+( USER.roleId === CONST_MAKER_PARTNER ? 
                '        <li class="form-row form-row-lg border-1px-top clearfix">'+
                '            <div class="form-row-left">'+
                '                <label>'+fnLanguageSwitch( '项目描述' )+'：</label>'+
                '            </div>'+
                '            <textarea class="product-description input" id="ProjectDepict" name="product-description">'+( fnIsEmp( productDescription ) ? productDescription : '' )+'</textarea>'+
                '        </li>' : '' )+
                '        <li class="form-row form-row-lg border-1px-top clearfix" style="height: auto;">'+
                '            <div class="form-row-left">'+
                '                <label>'+fnLanguageSwitch( '图片' )+'：</label>'+
                '            </div>'+
                '            <img id="upload_img" class="product-picture"  '+( fnIsEmp( photo ) ? 'data-selectorid="'+photo+'"' : ''  )+' onload="getImageCache( this )" src="../../image/project/add_pic.png" tapmode onclick="chooseGetType( this )">'+
                '            <p class="form-row-right">'+
                '                <span class="pic-name">'+fnLanguageSwitch( '未选择图片' )+'</span>'+
                '                <span>'+fnLanguageSwitch( 'ODM请上传主板图片' )+'，</span>'+
                '                <span>'+fnLanguageSwitch( 'OEM请上传主机图片' )+'；</span>'+
                '                <span>'+fnLanguageSwitch( '文件最大为10M' )+'。</span>'+
                '            </p>'+
                '        </li>'+
                '    </ul>';
        }

        _html += 
        '    <div style="height:1px"></div><div class="btn-next" tapmode="highlight" onclick="toNext()">'+( fnLanguageSwitch( api.pageParam.index === 2 ? api.pageParam.data ? '更新' : '提交' : '下一步' ) )+'</div>'+
        '    <div style="height:1px"></div>'+
        '</div>';

        $api.dom( 'body' ).innerHTML = 
        ' <div id="nav_group" class="border-1px-bottom">'+
        '    <div class="nav_btn step-1">'+fnLanguageSwitch( '做什么' )+'</div>'+
        '    <div class="nav_btn step-2">'+fnLanguageSwitch( '怎么做' )+'</div>'+
        '    <div class="nav_btn step-3">'+fnLanguageSwitch( '什么时候做' )+'</div>'+
        ' </div>'+
        '<div id="content_group" class="flex-con">'+_html+'</div>';


        for( var i =0; i < api.pageParam.index + 1; i++ ){
            $api.addCls( $api.domAll( '#nav_group .nav_btn' )[ i ], 'active');
        }
        $api.addCls( $api.domAll( '.content-box' )[ api.pageParam.index ], 'active');



    
//  这里开始重构
    	return;
        zhuge = api.require('zhuge');
        if (zhuge) {
            zhuge.initZhuge();
        }
        window.pageParam = api.pageParam;
        getPurchaseChannel();
        APPGetDateIntervalList();
        APPGetMarketApplicationList();
        APPGetIntelProductList();
        api.addEventListener({
            name: 'create_project_prev'
        }, function(ret, err){
            pagePreview();
        });
    };
    function pagePreview(){
        if (index == 1) {
            var from = api.pageParam.from;
            if(from && from == 'newProject'){
                api.execScript({
                    name: 'index',
                    frameName: 'frm_chain',
                    script: 'loadDataFromComandForMaker()'
                });
                api.closeToWin({
                    name: 'index'
                });
            }else{
                api.closeWin();
            }
        } else if(index == 2){
            $api.removeCls($api.dom('body .content-box.active'), 'active');
            $api.removeCls($api.dom('#nav_group .nav_btn.active'), 'active');
            $api.addCls($api.domAll('#content_group .content-box')[0], 'active');
            $api.addCls($api.domAll('#nav_group .nav_btn')[0], 'active');
            index = 1;
        } else if(index == 3){
            $api.removeCls($api.dom('#content_group .content-box.active'), 'active');
            $api.removeCls($api.dom('#nav_group .nav_btn.active'), 'active');
            $api.addCls($api.domAll('#content_group .content-box')[1], 'active');
            $api.addCls($api.domAll('#nav_group .nav_btn')[1], 'active');
            index = 2;
        }
    };

    var UICustomPickerId = 0;
    function openSelect(_data, callback) {
        $(".input").blur();
        $(".cover").removeClass('hidden');
        $('body').addClass('fixed');
        var selectContentOffset = $(".select-content").offset();
        UICustomPicker.open({
            rect: {
                x: 0,
                y: api.frameHeight - selectContentOffset.height,
                h: selectContentOffset.height
            },
            styles: {
                bg: 'rgba(0,0,0,0)',
                normalColor: '#959595',
                selectedColor: '#3685dd',
                selectedSize: 20,
                tagColor: '#3685dd',
                tagSize: 10
            },
            data: [{
                scope: _data
            }],
            rows: 5,
            fixedOn: api.frameName,
            autoHide: false,
            fixed: true
        }, function (ret, err) {
            if (callback && typeof(callback) == 'function') {
                callback(ret);
            }
        });
    }


    //第一个
    var projectAppNameList = [];
    function APPGetMarketApplicationList() {
    
//  	市场应用列表获取
		//  这里开始重构
		return;
        var local_projectAppNameList = $api.getStorage('projectAppNameList');
        if (api.connectionType == 'none') {
            if (local_projectAppNameList) {
                projectAppNameList = local_projectAppNameList;
            }
        } else {
            var bodyParam = {
                UserID: loginInfo.userid,
                BatchNo: loginInfo.batchno,
                UserType: loginInfo.usertype
            };
            var url = 'APPGetDataType/APPGetMarketApplicationList.aspx';
            ajaxRequest(url, 'get', bodyParam, function (ret, err) {
                api.hideProgress();
                if (ret) {
                    if (ret.res == 0) {
                        api.toast({
	
                            msg: ret.des
                        });
                    } else {
                        var data = [];
                        var appdata = ret.appdatalist;
                        if (appdata.length > 0) {
                            //todo i从1开始 屏蔽掉ProjectAppID": "-1"，"ProjectAppName": "---Select---"
                            for (var i = 1; appdata && i < appdata.length; i++) {
                                var obj = {
                                    id: appdata[i].ProjectAppID,
                                    value: appdata[i].ProjectAppName
                                };
                                data.push(obj);
                            }
                            projectAppNameList = data;
                            $api.setStorage('projectAppNameList', data);
                        }
                    }
                }
            })
        }
    }
    function setMarketApplicationList( el ){
        openSelector(el, fnApplicationMarketJson());
    };

    var projectStatusList = [
        {
            id: 1,
            value: '项目量产'
        },
        {
            id: 2,
            value: '项目研发'
        },
        {
            id: 3,
            value: '项目预研'
        }
    ];

    var projectStatusMap = {
        '项目量产' : 'Production',
        '项目研发' : 'Cultivate',
        '项目预研' : 'Design'
    }

    if (loginInfo.usertype == 1 || loginInfo.usertype == 5) {
        projectStatusList = [
            {
                id: 1,
                value: '原型完成'
            },
            {
                id: 2,
                value: '项目研发'
            },
            {
                id: 3,
                value: '项目预研'
            }
        ];
    }
    function AppGetProjectStatus( el ) {
        openSelector(el, fnProjectApprovalStatusJson() )
    }


    // 设置主板类型
    // setBoardType
    function setBoardType( el ) {
        openSelector(el, fnMainBoardTypeJson(), function( id ){
            if( id == 2 ){
                $api.removeCls($api.closest( $api.dom( '#projectMotherboard' ), 'li'), 'hidden');
            }else{
                $api.addCls($api.closest( $api.dom( '#projectMotherboard' ), 'li'), 'hidden');
            }
        });
    }

    function setPurchaseChannel( el ){
        openSelector(el, $api.getStorage('getPurchaseChannel' ), function( id ){

        });
    }

    var IntelProductList = [];
    function APPGetIntelProductList() {
//  	英特尔产品类型列表获取
		debugAlert( fnProductTypeJson() );

//这里开始重构
return;	


        var local_intelProductList = $api.getStorage('intelProductList');
        if (api.connectionType == 'none') {
            if (local_intelProductList) {
                IntelProductList = local_intelProductList;
            }
        } else {
            var bodyParam = {
                UserID: loginInfo.userid,
                BatchNo: loginInfo.batchno
            };
            var url = 'APPGetDataType/APPGetIntelProductList.aspx';
            ajaxRequest(url, 'get', bodyParam, function (ret, err) {
                api.hideProgress();
                if (ret) {
                    if (ret.res == 0) {
                        api.toast({
	
                            msg: ret.des
                        });
                    } else {
                        var data = [];
                        var appdata = ret.appdatalist;
                        if (appdata.length > 0) {
                            //todo i从1开始 屏蔽掉"---Select---"
                            for (var i = 1; appdata && i < appdata.length; i++) {
                                var obj = {
                                    id: appdata[i].ID,
                                    value: appdata[i].IntelProductType
                                };
                                data.push(obj);
                            }
                            IntelProductList = data;
                            $api.setStorage('intelProductList', data);
                        }
                    }
                }
            })
        }

    }

    function setIntelProductList(el) {
        openSelector( el, fnProductTypeJson(), function( id ){
            if( id === 'a681aa6e-ba92-45e6-a354-d6337ddc57b2' ){
                api.toast({
	
                                                msg: fnLanguageSwitch( '该产品需要升级成为企业用户' )
                });
                $api.html(el, '---'+fnLanguageSwitch( '请选择' )+'---');
                $api.removeAttr(el, 'data-selectorid');
            }

            var _el = $api.domAll( '.product-type[data-selectorid]' ),
                _filter = [],
                _index = 0;
            for( var i = 0; i < _el.length; i++ ){
                if( id === $api.attr(_el[i], 'data-selectorid' ) ){
                    ++_index;
                    if( _index > 1 ){
                        api.toast({
	
                            msg: fnLanguageSwitch( '不能选择相同的英特尔产品' )
                        });
                        $api.html(el, '---'+fnLanguageSwitch( '请选择' )+'---');
                        $api.removeAttr(el, 'data-selectorid');
                    }
                }
            }
        });
    };

    function setIntelProductList2(el) {
        openSelect(IntelProductList, function (selectRet) {
            UICustomPickerId = selectRet.id;
            if (selectRet.eventType == 'show') {
                IntelProductType2 = IntelProductList[0].value;
            } else {
                IntelProductType2 = selectRet.data[0].value;
            }
            $('#IntelProductType2').html(IntelProductType2);
            IntelProductQty2 = '';
            $("#IntelProductQty2").html('---Select---');
        });
    }
    ;
    function setIntelProductList3(el) {
        openSelect(IntelProductList, function (selectRet) {
            UICustomPickerId = selectRet.id;
            if (selectRet.eventType == 'show') {
                IntelProductType3 = IntelProductList[0].value;
            } else {
                IntelProductType3 = selectRet.data[0].value;
            }
            $('#IntelProductType3').html(IntelProductType3);
            IntelProductQty3 = '';
            $("#IntelProductQty3").html('---Select---');
        });
    }
    ;
    function setIntelProductList4(el) {
        openSelect(IntelProductList, function (selectRet) {
            UICustomPickerId = selectRet.id;
            if (selectRet.eventType == 'show') {
                IntelProductType4 = IntelProductList[0].value;
            } else {
                IntelProductType4 = selectRet.data[0].value;
            }
            $('#IntelProductType4').html(IntelProductType4);
            IntelProductQty4 = '';
            $("#IntelProductQty4").html('---Select---');
        });
    }
    ;
    function setIntelProductList5(el) {
        openSelect(IntelProductList, function (selectRet) {
            UICustomPickerId = selectRet.id;
            if (selectRet.eventType == 'show') {
                IntelProductType5 = IntelProductList[0].value;
            } else {
                IntelProductType5 = selectRet.data[0].value;
            }
            $('#IntelProductType5').html(IntelProductType5);
            IntelProductQty5 = '';
            $("#IntelProductQty5").html('---Select---');
        });
    };

    function showOther( el ){
        event.stopPropagation(); 
        $api.before(el, vGlobalUlHTML);
        if( $api.domAll( '.form2' ).length >= 5 ){
            $api.remove(el);
        }
    }

    function getProductQtys(index) {
        if (index == 1) {
            if (IntelProductType1 == 'CPU(处理器)') {
                return 3;
            } else if (IntelProductType1 == 'CHIPSET(芯片组)') {
                return 2;
            } else if (IntelProductType1 == 'Board or NUC(主板,迷你电脑)') {
                return 2;
            } else if (IntelProductType1 == 'LAN（网络芯片）') {
                return 9;
            } else {
                return 11;
            }
        } else if (index == 2) {
            if (IntelProductType2 == 'CPU(处理器)') {
                return 3;
            } else if (IntelProductType2 == 'CHIPSET(芯片组)') {
                return 2;
            } else if (IntelProductType2 == 'Board or NUC(主板,迷你电脑)') {
                return 2;
            } else if (IntelProductType2 == 'LAN（网络芯片）') {
                return 9;
            } else {
                return 11;
            }
        } else if (index == 3) {
            if (IntelProductType3 == 'CPU(处理器)') {
                return 3;
            } else if (IntelProductType3 == 'CHIPSET(芯片组)') {
                return 2;
            } else if (IntelProductType3 == 'Board or NUC(主板,迷你电脑)') {
                return 2;
            } else if (IntelProductType3 == 'LAN（网络芯片）') {
                return 9;
            } else {
                return 11;
            }
        } else if (index == 4) {
            if (IntelProductType4 == 'CPU(处理器)') {
                return 3;
            } else if (IntelProductType4 == 'CHIPSET(芯片组)') {
                return 2;
            } else if (IntelProductType4 == 'Board or NUC(主板,迷你电脑)') {
                return 2;
            } else if (IntelProductType4 == 'LAN（网络芯片）') {
                return 9;
            } else {
                return 11;
            }
        } else {
            if (IntelProductType5 == 'CPU(处理器)') {
                return 3;
            } else if (IntelProductType5 == 'CHIPSET(芯片组)') {
                return 2;
            } else if (IntelProductType5 == 'Board or NUC(主板,迷你电脑)') {
                return 2;
            } else if (IntelProductType5 == 'LAN（网络芯片）') {
                return 9;
            } else {
                return 11;
            }
        }
    }
    ;

    function getIntelProductQty( el ) {
        var _ = $api.attr($api.closest(el, 'ul').querySelector( '.product-type' ), 'data-selectorid' );
        if( _ ){
            openSelector(el, fnNumberOfDevicesUsedJson( USER.roleId === CONST_MAKER_ENTERPRISE &&  _ ));
        }else{
            api.toast({
                msg: fnLanguageSwitch( '请选择英特尔产品类型' )
            });
        }
   
    }

    function getIntelProductQty2() {
        var data = [];
        var len = getProductQtys(2);
        for (var i = 1; i < len; i++) {
            var obj = {
                id: i,
                value: i
            };
            data.push(obj);
        }
        openSelect(data, function (selectRet) {
            UICustomPickerId = selectRet.id;
            if (selectRet.eventType == 'show') {
                IntelProductQty2 = data[0].value;
            } else {
                IntelProductQty2 = selectRet.data[0].value;
            }
            $("#IntelProductQty2").html(IntelProductQty2);
        });
    }
    function getIntelProductQty3() {
        var data = [];
        var len = getProductQtys(3);
        for (var i = 1; i < len; i++) {
            var obj = {
                id: i,
                value: i
            };
            data.push(obj);
        }
        openSelect(data, function (selectRet) {
            UICustomPickerId = selectRet.id;
            if (selectRet.eventType == 'show') {
                IntelProductQty3 = data[0].value;
            } else {
                IntelProductQty3 = selectRet.data[0].value;
            }
            $("#IntelProductQty3").html(IntelProductQty3);
        });
    }
    function getIntelProductQty4() {
        var data = [];
        var len = getProductQtys(4);
        for (var i = 1; i < len; i++) {
            var obj = {
                id: i,
                value: i
            };
            data.push(obj);
        }
        openSelect(data, function (selectRet) {
            UICustomPickerId = selectRet.id;
            if (selectRet.eventType == 'show') {
                IntelProductQty4 = data[0].value;
            } else {
                IntelProductQty4 = selectRet.data[0].value;
            }
            $("#IntelProductQty4").html(IntelProductQty4);
        });
    }
    function getIntelProductQty5() {
        var data = [];
        var len = getProductQtys(5);
        for (var i = 1; i < len; i++) {
            var obj = {
                id: i,
                value: i
            };
            data.push(obj);
        }
        openSelect(data, function (selectRet) {
            UICustomPickerId = selectRet.id;
            if (selectRet.eventType == 'show') {
                IntelProductQty5 = data[0].value;
            } else {
                IntelProductQty5 = selectRet.data[0].value;
            }
            $("#IntelProductQty5").html(IntelProductQty5);
        });
    }


    //第三个
    var purchaseChannelList = [];

    function getPurchaseChannel() {
    
    
    	var loginInfo = $api.getStorage( 'loginInfo' );
    	
    // 获取采购渠道列表
        fnAjax({
            url: 'companies/getPurchaseChannel',
	        headers: {
	            authorization: loginInfo.token
	        },
	        debug: true
        }, function( ret, err ){
        	debugAlert( arguments )
        	if( ret ){
        	
            }else{
                api.toast({
	
                                                msg: fnLanguageSwitch( fnErrorJson( err.body.error.message ) )
                });
            }
        });
	    
	//  这里开始重构
	return;
        // APPGetPurchaseChannelList
        var data = $api.getStorage('APPGetPurchaseChannelList');
        if (api.connectionType == 'none') {
            if (data) {
                purchaseChannelList = data;
            } else {
                api.toast({
	
                    msg: 'The information about order channel hasn\'t been obtained.',
                    duration: 2000,
                    location: 'middle'
                });
            }

        } else {
            ajaxRequest('/APPGetDataType/APPGetPurchaseChannelList.aspx', 'get', {
                UserID: loginInfo.userid,
                BatchNo: loginInfo.batchno,
            }, function (ret, err) {
                if (ret && ret.res == undefined) {
                    // console.log('ret:normal===='+ JSON.stringify(ret));
                    var data = ret.appdatalist;
                    for (var i = 0; i < data.length; i++) {
                        purchaseChannelList.push({
                            value: data[i].ExpectedPurChan,
                            id: i
                        });
                    }
                } else {
                    console.log('ret:err====' + JSON.stringify(ret));
                }
                if (err) {
                    console.log('err====' + JSON.stringify(err));
                }
            });
        }
    }

    var dateIntervalList = [];
    function APPGetDateIntervalList() {
        var local_dateIntervalList = $api.getStorage('dateIntervalList');
        if (api.connectionType == 'none') {
            if (local_dateIntervalList) {
                dateIntervalList = local_dateIntervalList;
            }
        } else {
            var bodyParam = {
                UserID: loginInfo.userid,
                BatchNo: loginInfo.batchno
            };
            var url = 'APPGetDataType/APPGetDateIntervalList.aspx';
            ajaxRequest(url, 'get', bodyParam, function (ret, err) {
                api.hideProgress();
                if (ret) {
                    if (ret.res == 0) {
                        api.toast({
	
                            msg: ret.des
                        });
                    } else {
                        var data = [];
                        var appdata = ret.appdatalist;
                        if (appdata.length > 0) {
                            for (var i = 0; appdata && i < appdata.length; i++) {
                                var obj = {
                                    id: appdata[i].RangeID,
                                    value: appdata[i].RangeDate
                                };
                                data.push(obj);
                            }
                            dateIntervalList = data;
                            $api.setStorage('dateIntervalList', data);
                        }
                    }
                }
            });
        }
    }
    ;

    function setStartDate(el, index, txt) {
        openSelector(el, fnOneYearBeforeAndAfterJson(), function( time ){
            var _StartDate = $api.dom( '#StartDate' ) && Date.parse( $api.dom( '#StartDate' ).innerHTML ),
                _PurchaseDate = $api.dom( '#PurchaseDate' ) && Date.parse( $api.dom( '#PurchaseDate' ).innerHTML ),
                _PurchaseDate2 = $api.dom( '#PurchaseDate2' ) && Date.parse( $api.dom( '#PurchaseDate2' ).innerHTML );
            if( index === 1 ){
                if( _PurchaseDate && _PurchaseDate < _StartDate ){
                    api.toast({
	                   
                        msg: txt
                    });
                    $api.html(el, '---'+fnLanguageSwitch( '请选择' )+'---');
                    $api.removeAttr(el, 'data-selectorid');
                }
            }else if( index ===2 ){
                if( _PurchaseDate2 && _PurchaseDate2 < _StartDate ){
                    api.toast({
	                   
                        msg: txt
                    });
                    $api.html(el, '---'+fnLanguageSwitch( '请选择' )+'---');
                    $api.removeAttr(el, 'data-selectorid');
                }
            }else{
                if( _PurchaseDate && _StartDate > _PurchaseDate ){
                    api.toast({
	
                                                    msg: fnLanguageSwitch( '项目起始时间应该小于或等于量产时间' )
                    });
                    $api.html(el, '---'+fnLanguageSwitch( '请选择' )+'---');
                    $api.removeAttr(el, 'data-selectorid');
                }else if( _PurchaseDate2 && _StartDate > _PurchaseDate2 ){
                    api.toast({
	
                                                    msg: fnLanguageSwitch( '项目起始时间应该小于或等于小批量采购时间' )
                    });
                    $api.html(el, '---'+fnLanguageSwitch( '请选择' )+'---');
                    $api.removeAttr(el, 'data-selectorid');
                }
            }
        });
    };

    function setPurchaseDate(el) {
    	for( var x in dateIntervalList ){
    		dateIntervalList[x].value = fnFormatDate( dateIntervalList[x].value, true );
    	}
        openSelect(dateIntervalList, function (selectRet) {
            UICustomPickerId = selectRet.id;
            if (selectRet.eventType == 'show') {
                PurchaseDate = dateIntervalList[0].value;
            } else {
                PurchaseDate = selectRet.data[0].value;
            }
            $('#PurchaseDate').html(PurchaseDate);
            PurchaseDate = fnFormatDate( PurchaseDate );
        });
    }
    ;
    function setPurchaseDate2(el) {
    	for( var x in dateIntervalList ){
    		dateIntervalList[x].value = fnFormatDate( dateIntervalList[x].value, true );
    	}
        openSelect(dateIntervalList, function (selectRet) {
            UICustomPickerId = selectRet.id;
            if (selectRet.eventType == 'show') {
                PurchaseDate2 = dateIntervalList[0].value;
            } else {
                PurchaseDate2 = selectRet.data[0].value;
            }
            $('#PurchaseDate2').html(PurchaseDate2);
            PurchaseDate2 = fnFormatDate( PurchaseDate2 );
        });
    }
    ;


    var contentBoxs = $api.domAll('#content_group .content-box');
    var navBtns = $api.domAll('#nav_group .nav_btn');
    function toNext() {
        event.stopPropagation(); 
        switch( api.pageParam.index ){
            case 0:
                    var _ = {
                        projectName: $api.dom( '#projectName' ) && $api.dom( '#projectName' ).value,
                        projectAppId: $api.dom( '#projectApp' ) && $api.attr( $api.dom( '#projectApp' ), 'data-selectorid' ),
                        projectStatus: $api.dom( '#projectStatus' ) && +$api.attr( $api.dom( '#projectStatus' ), 'data-selectorid' ),
                        planQty: $api.dom( '#projectEstimated' ) && $api.dom( '#projectEstimated' ).value
                    };

                    if( $api.dom( '#projectName' ) && ! _.projectName ){
                        api.toast({
                            msg: fnLanguageSwitch( '项目名称不能为空' )
                        });
                    }else if( $api.dom( '#projectName' ) &&  ! ( _.projectName.length >= 2 &&   _.projectName.length <= 16 ) ){
                        api.toast({
                            msg: fnLanguageSwitch( '项目名称必须为 2 到 16 个字符之间' )
                        });
                    }else if( $api.dom( '#projectApp' ) && ! _.projectAppId ){
                        api.toast({
                            msg: fnLanguageSwitch( '市场应用不能为空' )
                        });
                    }else if( $api.dom( '#projectEstimated' ) && ! _.planQty ){
                        api.toast({
                            msg: fnLanguageSwitch( '预计年销量不能为空' )
                        });
                    }else if( $api.dom( '#projectStatus' ) && ! _.projectStatus ){
                        api.toast({
                            msg: fnLanguageSwitch( '项目状态不能为空' )
                        });
                    }else{
                        $api.rmStorage('projectStatus');
                        $api.setStorage('projectStatus', _.projectStatus);
                        api.execScript({
                            name: api.winName,
                            script: 'fnGroupIndex( true );'
                        });
                        api.execScript({
                            name: api.winName,
                            script: 'fnSubmit('+JSON.stringify( _ )+');'
                        });
                    }
            break;
            case 1:
                var _ = {
                    projectType: $api.dom( '#projectBoardtype' ) && +$api.attr($api.dom( '#projectBoardtype' ), 'data-selectorid'),
                    motherBoard: $api.dom( '#projectMotherboard' ) && $api.dom( '#projectMotherboard' ).value
                }
                var _vForm2EL = $api.domAll( '.form2' );
                if( $api.dom( '#projectBoardtype' ) && ! _.projectType ){
                    api.toast({
                        msg: fnLanguageSwitch( '请选择主板类型' )
                    });
                    return;
                }else if( $api.dom( '#projectBoardtype' ) && _.projectType == 2 && ! _.motherBoard ){
                    api.toast({
                        msg: fnLanguageSwitch( '请填写主板厂商' )
                    }); 
                    return;
                }

                _.intelProducts = [],
                _index = 0;
                for( var i = 0; i < _vForm2EL.length; i++ ){
                    _.intelProducts.push({
                        type: $api.attr( _vForm2EL[i].querySelector( '.product-type' ), 'data-selectorid' ),
                        num: _vForm2EL[i].querySelector( '.product-model' ).value,
                        qty: $api.attr(_vForm2EL[i].querySelector( '.product-count' ), 'data-selectorid' )
                    });

                    var _intel = _.intelProducts[ _.intelProducts.length - 1 ];
                    if( _index < 1 || _intel.type || _intel.num || _intel.qty ){
                        if( ! _intel.type ){
                            api.toast({
                                msg: fnLanguageSwitch( '英特尔产品类型不能为空' )
                            });
                            return;
                        }else if( ! _intel.num ){
                            api.toast({
                                msg: fnLanguageSwitch( '英特尔产品型号不能为空' )
                            });
                            return;
                        }else if( ! _intel.qty ){
                            api.toast({
        
                                msg: fnLanguageSwitch( '数量不能为空' )
                            });
                            return;
                        }   
                    }
                    if( _intel.type && _intel.num && _intel.qty ){
                        ++_index;
                    }else{
                        _.intelProducts.pop();
                        continue;
                    }
                }

                api.execScript({
                    name: api.winName,
                    script: 'fnGroupIndex( true );'
                });
                api.execScript({
                    name: api.winName,
                    script: 'fnSubmit('+JSON.stringify( _ )+');'
                });
            break;
            case 2:
                var _ = {
                    startDate: $api.dom( '#StartDate' ) && $api.attr($api.dom( '#StartDate' ), 'data-selectorid' ),
                    planDate: $api.dom( '#PurchaseDate' ) &&  $api.attr($api.dom( '#PurchaseDate' ), 'data-selectorid' ),
                    purchaseDate: $api.dom( '#PurchaseDate2' ) &&  $api.attr($api.dom( '#PurchaseDate2' ), 'data-selectorid' ),
                    purchaseQty: $api.dom( '#projectEstimated2' ) && $api.dom( '#projectEstimated2' ).value.trim(),
                    expectedPurChan: $api.dom( '#PurchaseChannel' ) && $api.attr($api.dom( '#PurchaseChannel' ), 'data-selectorid' ),
                    purchaseChannel: $api.dom( '#PurchaseChannelOther' ) && $api.dom( '#PurchaseChannelOther' ).value.trim(),
                    productDescription: $api.dom( '#ProjectDepict' ) && $api.dom( '#ProjectDepict' ).value.trim(),
                    photo: $api.dom( '#upload_img' ) && $api.attr($api.dom( '#upload_img' ), 'data-selectorid' )
                };
                    if( $api.dom( '#StartDate' ) && ! _.startDate ){
                        api.toast({
	
                            msg: fnLanguageSwitch( '项目起始时间不能为空' )
                        });
                    }else if( $api.dom( '#PurchaseDate' ) && ! _.planDate ){
                        api.toast({
	
                            msg: fnLanguageSwitch( '预计量产时间不能为空' )
                        });
                    }else if( $api.dom( '#PurchaseDate2' ) && ! _.purchaseDate ){
                        api.toast({
	
                            msg: fnLanguageSwitch( '小批量采购时间不能为空' )
                        });
                    }else if( $api.dom( '#projectEstimated2' ) && ! _.purchaseQty ){
                        api.toast({
	
                            msg: fnLanguageSwitch( '采购量不能为空' )
                        });
                    }else if( $api.dom( '#PurchaseChannel' ) && ! _.expectedPurChan ){
                        api.toast({
	
                            msg: fnLanguageSwitch( '预计采购渠道不能为空' )
                        });
                    }else if( $api.dom( '#PurchaseChannelOther' ) && ! _.purchaseChannel ){
                        api.toast({
	
                            msg: fnLanguageSwitch( '请填写其它采购渠道' )
                        });
                    }else if( $api.dom( '#ProjectDepict' ) && ! _.productDescription ){
                        api.toast({
	
                            msg: fnLanguageSwitch( '项目描述不能为空' )
                        });
                    }else if( $api.dom( '#upload_img' ) && [3, 4].indexOf( +$api.getStorage('projectStatus') ) !== -1 && ! _.photo ){
                        api.toast({
                            msg: fnLanguageSwitch( '图片不能为空' )
                        });
                    }else{
                        api.execScript({
                            name: api.winName,
                            script: 'fnSubmit('+JSON.stringify( _ )+', true);'
                        });
                    }
            break;
        }

        return;
    
    	var loginInfo = $api.getStorage( 'loginInfo' );
    	
//  	个人提交
        fnAjax({
            url: 'projects/person',
	        headers: {
	            authorization: loginInfo.token
	        },
	        debug: true,
	        method: 'post'
        }, function( ret, err ){
        	debugAlert( arguments )
        	if( ret ){
        	
            }else{
                api.toast({
	
                                                msg: fnLanguageSwitch( fnErrorJson( err.body.error.message ) )
                });
            }
        });    	
        
        return;
//  	企业提交
        fnAjax({
            url: 'projects/addCreate',
	        headers: {
	            authorization: loginInfo.token
	        },
	        debug: true,
	        method: 'post'
        }, function( ret, err ){
        	debugAlert( arguments )
        	if( ret ){
        	
            }else{
                api.toast({
	
                                                msg: fnLanguageSwitch( fnErrorJson( err.body.error.message ) )
                });
            }
        });
	    
	//  这里开始重构
	return;
	    
	//  这里开始重构
	return;
        // 中间获取表单数据

        if (index == 1) {
            projectName = $("#projectName").val();
            if ($.trim(projectName).length == 0) {
                api.alert({
                    title: 'Notice',
                    msg: 'Project name cannot be empty',
                    buttons: ['I got it.']
                }, function (ret, err) {

                });
                return;
            }
            if ($.trim(projectApp).length == 0) {
                api.alert({
                    title: 'Notice',
                    msg: 'Application cannot be empty',
                    buttons: ['I got it.']
                }, function (ret, err) {

                });
                return;
            }
            if (loginInfo.usertype == 1 || loginInfo.usertype == 5) {

            } else {
                projectEstimated = $.trim($('#projectEstimated').val());
                if (projectEstimated.length == 0) {
                    api.alert({
                        title: 'Notice',
                        msg: 'Est. Annual Sale cannot be empty',
                        buttons: ['I got it.']
                    }, function (ret, err) {

                    });
                    return;
                }
                if ( ! /^[0-9]+([.]{1}[0-9]+){0,1}$/g.test( projectEstimated ) ) {
                    api.alert({
                        title: 'Notice',
                        msg: 'Est. Annual Sale should be a number',
                        buttons: ['I got it.']
                    }, function (ret, err) {

                    });
                    return;
                }
            }
            if ($.trim(projectStatus).length == 0) {
                api.alert({
                    title: 'Notice',
                    msg: 'Status cannot be empty',
                    buttons: ['I got it.']
                }, function (ret, err) {

                });
                return;
            }
            index++;
            $api.removeCls($api.dom('#content_group .content-box.active'), 'active');
            $api.removeCls($api.dom('#nav_group .nav_btn.active'), 'active');
            $api.addCls($api.domAll('#content_group .content-box')[index - 1], 'active');
            $api.addCls($api.domAll('#nav_group .nav_btn')[index - 1], 'active');
        } else if (index == 2) {

            if (loginInfo.usertype == 1 || loginInfo.usertype == 5) {
                if ($.trim(IntelProductType1).length == 0) {
                    api.alert({
                        title: 'Notice',
                        msg: 'Intel Product Type cannot be empty',
                        buttons: ['I got it.']
                    }, function (ret, err) {

                    });
                    return;
                }
                IntelProductNum1 = $.trim($('#IntelProductNum1').val());
                if (IntelProductNum1.length == 0) {
                    api.alert({
                        title: 'Notice',
                        msg: 'Intel Product Model cannot be empty',
                        buttons: ['I got it.']
                    }, function (ret, err) {

                    });
                    return;
                }
                if ($.trim(IntelProductQty1).length == 0) {
                    api.alert({
                        title: 'Notice',
                        msg: 'Equipment Used Volume cannot be empty',
                        buttons: ['I got it.']
                    }, function (ret, err) {

                    });
                    return;
                }
                index++;
                $api.removeCls($api.dom('#content_group .content-box.active'), 'active');
                $api.removeCls($api.dom('#nav_group .nav_btn.active'), 'active');
                $api.addCls($api.domAll('#content_group .content-box')[index - 1], 'active');
                $api.addCls($api.domAll('#nav_group .nav_btn')[index - 1], 'active');
            } else {
                if (ProjectType.length == 0) {
                    api.alert({
                        title: 'Notice',
                        msg: 'Please select Type of Motherboard',
                        buttons: ['I got it.']
                    }, function (ret, err) {

                    });
                    return;
                }
                if (fnTranslation( ProjectType ) == '外购主板') {
                    MotherBoard = $.trim($('#projectMotherboard').val());
                    if (MotherBoard.length == 0) {
                        api.alert({
                            title: 'Notice',
                            msg: 'Please fill in the motherboard manufacturer',
                            buttons: ['I got it.']
                        }, function (ret, err) {

                        });
                        return false;
                    }
                }
                if ($.trim(IntelProductType1).length == 0) {
                    api.alert({
                        title: 'Notice',
                        msg: 'Intel Product Type cannot be empty',
                        buttons: ['I got it.']
                    }, function (ret, err) {

                    });
                    return;
                }
                IntelProductNum1 = $.trim($('#IntelProductNum1').val());
                if ($.trim(IntelProductNum1).length == 0) {
                    api.alert({
                        title: 'Notice',
                        msg: 'Intel Product Model cannot be empty',
                        buttons: ['I got it.']
                    }, function (ret, err) {

                    });
                    return;
                }
                if ($.trim(IntelProductQty1).length == 0) {
                    api.alert({
                        title: 'Notice',
                        msg: 'Equipment Used Volume cannot be empty',
                        buttons: ['I got it.']
                    }, function (ret, err) {

                    });
                    return;
                }
                var limitCpu = 0,
                        limitChipset = 0,
                        limitBoard = 0,
                        limitLan = 0,
                        limitSsd = 0;
                var productTypes = $api.domAll('.form2 .product-type');
                for (var i = 0; i < productTypes.length; i++) {
                    var _productType = $.trim($(productTypes[i]).text());
                    if (_productType == 'CPU(处理器)') {
                        limitCpu++;//1
                    } else if (_productType == 'CHIPSET(芯片组)') {
                        limitChipset++;//1
                    } else if (_productType == 'Board or NUC(主板,迷你电脑)') {
                        limitBoard++;//1
                    } else if (_productType == 'LAN（网络芯片）') {
                        limitLan++;//3
                    } else if (_productType == 'SSD（固态硬盘）') {
                        limitSsd++;//1
                    }
                }
                if (limitCpu > 1) {
                    api.alert({
                        title: 'Notice',
                        msg: 'CPU can only be chosen once',
                        buttons: ['I got it.']
                    }, function (ret, err) {

                    });
                    return;
                }
                if (limitChipset > 1) {
                    api.alert({
                        title: 'Notice',
                        msg: 'CHIPSET can only be chosen once',
                        buttons: ['I got it.']
                    }, function (ret, err) {

                    });
                    return;
                }
                if (limitBoard > 1) {
                    api.alert({
                        title: 'Notice',
                        msg: 'Board or NUC can only be chosen once',
                        buttons: ['I got it.']
                    }, function (ret, err) {

                    });
                    return;
                }
                if (limitLan > 3) {
                    api.alert({
                        title: 'Notice',
                        msg: 'LAN can only be chosen three times',
                        buttons: ['I got it.']
                    }, function (ret, err) {

                    });
                    return;
                }
                if (limitSsd > 1) {
                    api.alert({
                        title: 'Notice',
                        msg: 'SSD can only be chosen three times',
                        buttons: ['I got it.']
                    }, function (ret, err) {

                    });
                    return;
                }
                if ($.trim(IntelProductType2).length > 0) {
                    IntelProductNum2 = $.trim($('#IntelProductNum2').val());
                    if ($.trim(IntelProductNum2).length == 0) {
                        api.alert({
                            title: 'Notice',
                            msg: 'Intel Product Model cannot be empty',
                            buttons: ['I got it.']
                        }, function (ret, err) {

                        });
                        return;
                    }
                    if ($.trim(IntelProductQty2).length == 0) {
                        api.alert({
                            title: 'Notice',
                            msg: 'Equipment Used Volume cannot be empty',
                            buttons: ['I got it.']
                        }, function (ret, err) {

                        });
                        return;
                    }
                } else {
                    IntelProductNum2 = ''
                    IntelProductQty2 = '';
                }
                if ($.trim(IntelProductType3).length > 0) {
                    IntelProductNum3 = $.trim($('#IntelProductNum3').val());
                    if ($.trim(IntelProductNum3).length == 0) {
                        api.alert({
                            title: 'Notice',
                            msg: 'Intel Product Model cannot be empty',
                            buttons: ['I got it.']
                        }, function (ret, err) {

                        });
                        return;
                    }
                    if ($.trim(IntelProductQty3).length == 0) {
                        api.alert({
                            title: 'Notice',
                            msg: 'Equipment Used Volume cannot be empty',
                            buttons: ['I got it.']
                        }, function (ret, err) {

                        });
                        return;
                    }
                } else {
                    IntelProductNum3 = ''
                    IntelProductQty3 = '';
                }
                if ($.trim(IntelProductType4).length > 0) {
                    IntelProductNum4 = $.trim($('#IntelProductNum4').val());
                    if ($.trim(IntelProductNum4).length == 0) {
                        api.alert({
                            title: 'Notice',
                            msg: 'Intel Product Model cannot be empty',
                            buttons: ['I got it.']
                        }, function (ret, err) {

                        });
                        return;
                    }
                    if ($.trim(IntelProductQty4).length == 0) {
                        api.alert({
                            title: 'Notice',
                            msg: 'Equipment Used Volume cannot be empty',
                            buttons: ['I got it.']
                        }, function (ret, err) {

                        });
                        return;
                    }
                } else {
                    IntelProductNum4 = ''
                    IntelProductQty4 = '';
                }
                if ($.trim(IntelProductType5).length > 0) {
                    IntelProductNum5 = $.trim($('#IntelProductNum5').val());
                    if ($.trim(IntelProductNum5).length == 0) {
                        api.alert({
                            title: 'Notice',
                            msg: 'Intel Product Model cannot be empty',
                            buttons: ['I got it.']
                        }, function (ret, err) {

                        });
                        return;
                    }
                    if ($.trim(IntelProductQty5).length == 0) {
                        api.alert({
                            title: 'Notice',
                            msg: 'Equipment Used Volume cannot be empty',
                            buttons: ['I got it.']
                        }, function (ret, err) {

                        });
                        return;
                    }
                } else {
                    IntelProductNum5 = ''
                    IntelProductQty5 = '';
                }
                if (limitCpu == 1 && limitChipset == 0) {
                    api.confirm({
                        title: 'Notice',
                        msg: ' Please confirm that you have selected to the single chip plan, otherwise please enter the specific model of this corresponding chipset.Continue to submit, please click "confirm", return to fill out, please click "cancel".',
                        buttons: ['cancel', 'Credit']
                    }, function (ret, err) {
                        if (ret.buttonIndex == 2) {
                            index++;
                            $api.removeCls($api.dom('#content_group .content-box.active'), 'active');
                            $api.removeCls($api.dom('#nav_group .nav_btn.active'), 'active');
                            $api.addCls($api.domAll('#content_group .content-box')[index - 1], 'active');
                            $api.addCls($api.domAll('#nav_group .nav_btn')[index - 1], 'active');
                        }
                    });
                    return;
                }
                if (limitCpu == 0 && limitChipset == 1) {

                    api.confirm({
                        title: 'Notice',
                        msg: 'Please confirm that you have selected to the single chip plan, otherwise please enter the specific model of this corresponding chipset.Continue to submit, please click "confirm", return to fill out, please click "cancel".',
                        buttons: ['cancel', 'Credit']
                    }, function (ret, err) {
                        if (ret.buttonIndex == 2) {
                            index++;
                            $api.removeCls($api.dom('#content_group .content-box.active'), 'active');
                            $api.removeCls($api.dom('#nav_group .nav_btn.active'), 'active');
                            $api.addCls($api.domAll('#content_group .content-box')[index - 1], 'active');
                            $api.addCls($api.domAll('#nav_group .nav_btn')[index - 1], 'active');
                        }
                    });
                    return;
                }
                index++;
                $api.removeCls($api.dom('#content_group .content-box.active'), 'active');
                $api.removeCls($api.dom('#nav_group .nav_btn.active'), 'active');
                $api.addCls($api.domAll('#content_group .content-box')[index - 1], 'active');
                $api.addCls($api.domAll('#nav_group .nav_btn')[index - 1], 'active');
            }

        } else if (index == 3) {
            if ($.trim(StartDate).length == 0) {
                api.alert({
                    title: 'Notice',
                    msg: 'Project starts at cannot be empty',
                    buttons: ['I got it.']
                }, function (ret, err) {

                });
                return;
            }
            if (loginInfo.usertype == 1 || loginInfo.usertype == 5) {
                if ($.trim(PurchaseDate).length == 0) {
                    api.alert({
                        title: 'Notice',
                        msg: 'Prod. Date cannot be empty',
                        buttons: ['I got it.']
                    }, function (ret, err) {

                    });
                    return;
                }
                if (parseInt(StartDate) > parseInt(PurchaseDate)) {
                    api.alert({
                        title: 'Notice',
                        msg: 'Prod. Date should be no early than Start Date',
                        buttons: ['I got it.']
                    });
                    return false;
                } else if (parseInt(StartDate) == parseInt(PurchaseDate)) {
                    if (parseInt(StartDate.substr(5)) > parseInt(PurchaseDate.substr(5))) {
                        api.alert({
                            title: 'Notice',
                            msg: 'Prod. Date should be no early than Start Date',
                            buttons: ['I got it.']
                        });
                        return false;
                    }
                }
            } else {
                if ($.trim(PurchaseDate2).length == 0) {
                    api.alert({
                        title: 'Notice',
                        msg: 'Est. Pilot. Date cannot be empty',
                        buttons: ['I got it.']
                    }, function (ret, err) {

                    });
                    return;
                }
                if (parseInt(StartDate) > parseInt(PurchaseDate2)) {
                    api.alert({
                        title: 'Notice',
                        msg: 'Pilot. Date should be no early than Start Date',
                        buttons: ['I got it.']
                    });
                    return false;
                } else if (parseInt(StartDate) == parseInt(PurchaseDate2)) {
                    if (parseInt(StartDate.substr(5)) > parseInt(PurchaseDate2.substr(5))) {
                        api.alert({
                            title: 'Notice',
                            msg: 'Pilot. Date should be no early than Start Date',
                            buttons: ['I got it.']
                        });
                        return false;
                    }
                }
            }


            if (loginInfo.usertype == 1 || loginInfo.usertype == 5) {
                projectEstimated2 = '';
            } else {
                projectEstimated2 = $('#projectEstimated2').val();
                if (isNaN(projectEstimated2)) {
                    api.alert({
                        title: 'Notice',
                        msg: 'Pilot. Volume should be a number',
                        buttons: ['I got it.']
                    }, function (ret, err) {

                    });
                    return;
                }
            }
            if (projectStatus == '项目量产') {
                if (projectEstimated2 < ( 50 / 1000 ) ) {
                    api.alert({
                        title: 'Notice',
                        msg: 'In ' + projectStatusMap[projectStatus] + ' Pilot Stage. Volume cannot be smaller than 50',
                        buttons: ['I got it.']
                    }, function (ret, err) {

                    });
                    return;
                }
            }
            if (projectStatus == '项目量产' || projectStatus == '原型完成') {
                if ($.trim(Photo).length == 0) {
                    api.alert({
                        title: 'Notice',
                        msg: 'Image cannot be empty',
                        buttons: ['I got it.']
                    }, function (ret, err) {

                    });
                    return;
                }
            }
            if (loginInfo.usertype == 1 || loginInfo.usertype == 5) {
                ProjectDepict = $.trim($('#ProjectDepict').val());
                if (ProjectDepict.length == 0) {
                    api.alert({
                        title: 'Notice',
                        msg: 'Project Description cannot be empty',
                        buttons: ['I got it.']
                    }, function (ret, err) {

                    });
                    return;
                }
            } else {
                if ($.trim(PurchaseChannel).length == 0) {
                    api.alert({
                        title: 'Notice',
                        msg: 'Est. Order Channel cannot be empty',
                        buttons: ['I got it.']
                    }, function (ret, err) {

                    });
                    return;
                }
                if (purchaseChannel == 'Other') {
                    purchaseChannelOther = $.trim($('#PurchaseChannelOther').val());
                    if (purchaseChannelOther.length == 0) {
                        api.alert({
                            title: 'Notice',
                            msg: 'Please input other Order Channels',
                            buttons: ['I got it.']
                        }, function (ret, err) {

                        });
                        return;
                    }
                }
            }
            APPSubmitProjectInfo();
        }
    }
    ;

    function APPSubmitProjectInfo() {
        var valueParam = {
            ActiveItemID: $api.getStorage('ITEMIDFORWEBWINPAGE') || 0,
            UserID: loginInfo.userid,
            BatchNo: loginInfo.batchno,
            ProjectType: fnTranslation( ProjectType ), // 0
            MotherBoard: MotherBoard, // 0
            IntelProductNum1: IntelProductNum1,
            IntelProductQty1: IntelProductQty1,
            IntelProductType1: IntelProductType1,
            IntelProductNum2: IntelProductNum2, // 0
            IntelProductQty2: IntelProductQty2, // 0
            IntelProductType2: IntelProductType2, // 0
            IntelProductNum3: IntelProductNum3, // 0
            IntelProductQty3: IntelProductQty3, // 0
            IntelProductType3: IntelProductType3, // 0
            IntelProductNum4: IntelProductNum4, // 0
            IntelProductQty4: IntelProductQty4, // 0
            IntelProductType4: IntelProductType4, // 0
            IntelProductNum5: IntelProductNum5, // 0
            IntelProductQty5: IntelProductQty5, // 0
            IntelProductType5: IntelProductType5, // 0
            ProjectApp:projectApp,
            ProjectDepict: ProjectDepict,
            ProjectID: 0,
            ProjectName: projectName,
            ProjectStatus: projectStatus,
            PurchaseDate: PurchaseDate,
            StartDate: StartDate ,
            PlanQTY: projectEstimated, // 0
            PurchaseQTY: projectEstimated2, // 0
            ExpectedPurChan: purchaseChannel, // 0
            PurchaseChannel: purchaseChannelOther, // 0
            SubType: 1,
            UserType: loginInfo.usertype
        };     
        if (loginInfo.usertype == 1 || loginInfo.usertype == 5) {
            valueParam.PurchaseDate = PurchaseDate;
        } else {
            valueParam.PurchaseDate =  PurchaseDate2;
        }
        var url = 'APPProjectManage/APPSubmitProjectInfo.aspx';
        var fileParam = {
            Photo: Photo
        };
        api.showProgress({
            title: 'Processing...',
            text: '',
            modal: false
        });
        ajaxRequest('APPGetDataType/APPCheckUserEmail.aspx', 'get', {
            UserID: loginInfo.userid,
            BatchNo: loginInfo.batchno,
        }, function (ret, err) {
            if (ret && ret.res == 1) {
                ajaxRequest(url, 'post', valueParam, fileParam, function (ret, err) {
                    api.hideProgress();
                    if (ret) {
                        if (ret.res == 1) {
                            api.sendEvent({
                                name: 'refresh_support_frame'
                            });
                            var from = api.pageParam.from;
                            if(from && from == 'support'){
                                api.closeWin();
                                return false;
                            }
                            var ProjectID = ret.ProjectID;
                            var move = isHuawei();
                            var animation = {};
                            if (move) {
                                animation = {
                                    type: 'movein',
                                    subType: 'from_right'
                                }
                            }
                            ;
                            api.openWin({
                                name: 'simple_win_for_new_comand',
                                url: 'widget://' + DIR + '/simple_page/simple_win.html',
                                bounces: false,
                                pageParam: {
                                    name: 'create_new_comand',
                                    title: 'New Demand',
                                    bounces: false,
                                    ProjectID: ProjectID,
                                    from: 'newProject'
                                },
                                animation: animation
                            });
                        }else{
                            api.toast({
	
                                msg: fnTranslation( ret.des, true)
                            });
                        }
                    } else {
                        api.toast({
	
                            msg: err.msg
                        });
                    }
                })
            } else {
                api.hideProgress();
                api.alert({
                    title: 'Notice',
                    msg: 'Please complete your profile first.'
                }, function () {
                    var move = isHuawei();
                    var animation = {};
                    if (move) {
                        animation = {
                            type: 'movein',
                            subType: 'from_right'
                        }
                    }
                    api.openWin({
                        name: 'profile_win',
                        url: 'widget://' + DIR + '/member_center/profile.html',
                        bounces: false,
                        animation: animation
                    });
                });
            }
            if (err) {
                api.toast({
	
                    msg: JSON.stringify(err),
                    duration: 2000,
                    location: 'middle'
                });
            }
        });
    };

    function chooseGetType( el ) {
        fnGetPicture(el, function( path ){
            el.src = path;
        });
    }
</script>
</html>